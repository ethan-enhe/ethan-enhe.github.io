I"Û-<h2 id="é—®é¢˜å½¢å¼">é—®é¢˜å½¢å¼</h2>

<p>ç”¨æ¥ä¼˜åŒ–ä¸€ç±» dpï¼Œå…¶è½¬ç§»æ–¹ç¨‹æ»¡è¶³ï¼š</p>

\[dp_i=f_i(\max_{j&lt;i}(k_j\times x_i+b_j))\]

<p>ï¼ˆå¼å­ä¸­å– min ä¹Ÿå¯ï¼Œä¸ max ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ï¼‰</p>

<p>å…¶ä¸­ $k_j,b_j$ æ˜¯åªä¸ j ç›¸å…³çš„æ•°ï¼Œ$x_i$ æ˜¯åªä¸ i ç›¸å…³çš„æ•°ï¼Œ$f_i$ æ˜¯åªä¸ i æœ‰å…³çš„å‡½æ•°ã€‚</p>

<p>æ–œç‡ä¼˜åŒ–å°±æ˜¯ä¼˜åŒ–çš„æ±‚ $\max_{j&lt;i}(k_j\times x_i+b_j)$ çš„è¿‡ç¨‹ã€‚</p>

<!--more-->

<h2 id="ä¸¤ç§ç†è§£">ä¸¤ç§ç†è§£</h2>

<h3 id="æˆªè·æ³•">æˆªè·æ³•</h3>

<p>å°†æ¯ä¸ª j å¯¹åº”åˆ°å¹³é¢ä¸Šä¸€ç‚¹ $(k_j,b_j)$ï¼Œç„¶åç”¨ä¸€ä¸ªæ–œç‡ä¸º $-x_i$ çš„ç›´çº¿ä»ä¸Šå¾€ä¸‹ç§»åŠ¨ï¼Œç›´åˆ°ç¢°åˆ°ä¸€ä¸ªç‚¹ï¼Œæ­¤æ—¶ y è½´æˆªè·å³ä¸ºç­”æ¡ˆã€‚</p>

<h3 id="å‡½æ•°æ³•">å‡½æ•°æ³•</h3>

<p>å°† $g_j(x)=k_j\times x+b_j$ çœ‹æˆåªä¸ j æœ‰å…³çš„çš„<strong>ä¸€æ¬¡å‡½æ•°</strong>ï¼ŒåŸå¼ç­‰ä»·äºåœ¨ $x=x_i$ å¤„æ‰€æœ‰å‡½æ•°çš„æå€¼ã€‚</p>

<p>æ„Ÿè§‰è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¥½ç†è§£ï¼Œåæ–‡éƒ½ä»¥æ­¤æ–¹æ³•ä¸ºä¾‹ã€‚</p>

<h2 id="å¦‚ä½•ç»´æŠ¤">å¦‚ä½•ç»´æŠ¤</h2>

<p>å› ä¸ºæ˜¯å°†æ‰€æœ‰ä¸€æ¬¡å‡½æ•°å– maxï¼Œæ‰€ä»¥æ‰€æœ‰å¯èƒ½æˆä¸ºç­”æ¡ˆçš„ç›´çº¿å¿…å®šæ˜¯ä¸€ä¸ª<strong>æ–œç‡é€’å¢</strong>çš„<strong>ä¸‹å‡¸å£³</strong>ï¼Œåœ¨ä¸åŒæƒ…å†µä¸‹ï¼Œå¯é‡‡ç”¨ä¸åŒçš„æ–¹æ³•ç»´æŠ¤å‡¸å£³ä¸Šçš„å‡½æ•°ã€‚</p>

<h3 id="k_ix_i-éƒ½éš-i-é€’å¢å•è°ƒé˜Ÿåˆ—">$k_i,x_i$ éƒ½éš i é€’å¢â€”â€”å•è°ƒé˜Ÿåˆ—</h3>

<p>æ’å…¥ç›´çº¿æ—¶ï¼Œä¸æ–­å¼¹å‡ºé˜Ÿå°¾ï¼Œç›´åˆ°é˜Ÿå°¾çš„ç›´çº¿åœ¨å‡¸å£³ä¸Šæ²¡æœ‰è¢«æ–°ç›´çº¿<strong>å®Œå…¨è¦†ç›–</strong>ï¼Œå†å°†æ–°é˜Ÿåˆ—åŠ å…¥é˜Ÿå°¾ã€‚</p>

<p>æŸ¥è¯¢æ—¶ï¼Œä¸æ–­å¼¹å‡ºé˜Ÿé¦–ï¼Œç›´åˆ°é˜Ÿåˆ—å‰ä¸¤æ¡ç›´çº¿çš„äº¤ç‚¹å¤§äº $x_i$ï¼Œæ­¤æ—¶é˜Ÿé¦–çš„å‡½æ•°å³ä¸ºç­”æ¡ˆã€‚</p>

<h3 id="k_i-éš-i-é€’å¢x_i-ä¸éš-i-é€’å¢å•è°ƒé˜Ÿåˆ—äºŒåˆ†">$k_i$ éš i é€’å¢ï¼Œ$x_i$ ä¸éš i é€’å¢â€”â€”å•è°ƒé˜Ÿåˆ—+äºŒåˆ†</h3>

<p>æ’å…¥æ–¹æ³•åŒä¸Šï¼ŒæŸ¥è¯¢æ—¶ä¸èƒ½ç›´æ¥å¼¹é˜Ÿé¦–äº†ï¼Œåº”è¯¥åœ¨é˜Ÿåˆ—ä¸ŠäºŒåˆ†ï¼Œæ‰¾åˆ°å‡¸å£³ä¸ŠåŒ…å« $x_i$ çš„ä¸€æ®µç›´çº¿ã€‚</p>

<h3 id="k_ix_i-éƒ½ä¸éš-i-é€’å¢æè¶…æ ‘">$k_i,x_i$ éƒ½ä¸éš i é€’å¢â€”â€”æè¶…æ ‘</h3>

<p>å¯ä»¥ç”¨æè¶…æ ‘ç»´æŠ¤è¿™ä¸ªå‡¸å£³ï¼Œåæ–‡æœ‰ä»‹ç»ï¼Œï¼ˆå¬è¯´ä¹Ÿå¯ä»¥ç”¨å¹³è¡¡æ ‘ï¼ŒCDQ åˆ†æ²»ç»´æŠ¤ï¼Œä½†ä¸å¤ªå¥½å†™ï¼‰ã€‚</p>

<h2 id="ç®€å•å¿«æ·æè¶…æ ‘">ç®€å•å¿«æ·æè¶…æ ‘</h2>

<p>æè¶…æ ‘æ˜¯ä¸€ä¸ªæ”¯æŒä»¥ $O(\log n)$ å¤æ‚åº¦æ’å…¥ä¸€æ¡ç›´çº¿ï¼ˆå¦‚æœæ˜¯æ’å…¥çº¿æ®µï¼Œåˆ™å¤æ‚åº¦ä¸º $O(\log^2 n)$ï¼‰ï¼Œå¹¶ä»¥åŒæ ·å¤æ‚åº¦æŸ¥è¯¢æŸä¸€ä¸ªä½ç½®çš„æœ€å¤§å€¼çš„çº¿æ®µæ ‘ã€‚</p>

<h3 id="æ’å…¥æ“ä½œ">æ’å…¥æ“ä½œ</h3>

<p>æè¶…æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç»´æŠ¤çš„æ˜¯ï¼šåœ¨å½“å‰åŒºé—´çš„<strong>ä¸­ç‚¹</strong>ï¼Œå‡½æ•°å€¼æœ€å¤§çš„å‡½æ•°ï¼ˆä¸‹ç§°æœ€ä¼˜å‡½æ•°ï¼‰ï¼Œå¯ä»¥å¦‚ä¸‹æ›´æ–°ï¼š</p>

<ul>
  <li>è€ƒè™‘æ–°æ’å…¥çš„å‡½æ•°ï¼Œä¸åŒºé—´çš„åŸæœ€ä¼˜å‡½æ•°ï¼š</li>
  <li>å°†ä¸¤è€…ä¸­è¾ƒ<strong>ä¼˜</strong>çš„å­˜åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Š</li>
  <li>ç”¨ä¸¤è€…ä¸­è¾ƒ<strong>åŠ£</strong>çš„æ›´æ–°å­åŒºé—´ï¼š
    <ul>
      <li>å¦‚æœè¾ƒåŠ£çš„å‡½æ•°æ¯”è¾ƒä¼˜çš„å‡½æ•°æ–œç‡<strong>å¤§</strong>ï¼Œåˆ™ç”¨å…¶é€’å½’æ›´æ–°<strong>å³å­åŒºé—´</strong>ï¼ˆå¦‚ä¸‹é¢å›¾ 1 æ‰€ç¤ºï¼Œè¿™æ¡çº¿æ®µä»ç„¶æœ‰å¯èƒ½åœ¨å³å­åŒºé—´é‡Œæˆä¸ºæœ€ä¼˜å‡½æ•°ï¼‰</li>
      <li>å¦åˆ™ç”¨å…¶é€’å½’æ›´æ–°<strong>å·¦å­åŒºé—´</strong>ï¼ˆåŒç†ï¼‰</li>
    </ul>
  </li>
</ul>

<p><img src="https://pic.imgdb.cn/item/60bf0f33844ef46bb24a61d4.jpg" alt="å›¾ 1" /></p>

<h3 id="æŸ¥è¯¢æ“ä½œ">æŸ¥è¯¢æ“ä½œ</h3>

<p>æ±‚ x å¤„æœ€å¤§çš„å‡½æ•°å€¼ï¼Œåªéœ€å°†çº¿æ®µæ ‘ä¸Š x æ‰€åœ¨åŒºé—´ï¼Œä»¥åŠå®ƒç¥–å…ˆä¸Šæ‰€æœ‰åŒºé—´çš„æœ€ä¼˜å‡½æ•°ï¼Œåœ¨xå¤„çš„å‡½æ•°å€¼å– max å³å¯ã€‚</p>

<h2 id="é¢˜ç›®">é¢˜ç›®</h2>

<h3 id="acwing-301-ä»»åŠ¡å®‰æ’2"><a href="https://www.acwing.com/problem/content/303/">AcWing 301. ä»»åŠ¡å®‰æ’2</a></h3>

<p>è´¹ç”¨æå‰è®¡ç®—ï¼Œè®° $t_i,c_i$ çš„å‰ç¼€å’Œä¸º $st_i,sc_i$ï¼Œåˆ—å‡ºè½¬ç§»æ–¹ç¨‹ï¼š</p>

\[dp_i=\min_{j&lt;i}(\underbrace{-sc_j}_{k_j}\times \underbrace{st_i}_{x_i}+\underbrace{dp_j+s\times(sc_n-sc_j)}_{b_j})+st_i*sc_i\]

<p>å…¶ä¸­æ–œç‡ä¸æ¨ªåæ ‡ $-sc_j,st_i$ éƒ½å•è°ƒï¼Œåªéœ€å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å³å¯ <del>ä½†æˆ‘æ˜¯æ‹¿äºŒåˆ†çš„ä»£ç è¿‡çš„</del>ã€‚</p>

<h3 id="acwing-302-ä»»åŠ¡å®‰æ’3"><a href="https://www.acwing.com/problem/content/303/">AcWing 302. ä»»åŠ¡å®‰æ’3</a></h3>

<p>ä¸ä¸Šä¸€é¢˜é¢˜æ„ç›¸åŒï¼ŒåŒºåˆ«åœ¨ $st_i$ ä¸å•è°ƒï¼Œåªéœ€åœ¨å•è°ƒé˜Ÿåˆ—ä¸ŠäºŒåˆ†å³å¯ã€‚</p>

<p><strong>ä»£ç ï¼š</strong></p>

<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
#define fi first
#define se second
#define mp make_pair
using namespace std;
typedef long long ll;
typedef pair&lt;ll,ll&gt; pi;
const ll INF=1e18;
const ll MXN=3e5+5;

inline long double inter(const pi &amp;x,const pi &amp;y){return x.fi==y.fi?(x.se&gt;y.se?-INF:INF):(long double)(y.se-x.se)/(x.fi-y.fi);}

ll n,s,sc[MXN],st[MXN],dp[MXN];
pi q[MXN];ll ql=1,qr;
int main(){
	scanf("%lld%lld",&amp;n,&amp;s);
	for(int i=1;i&lt;=n;i++){
		scanf("%lld%lld",st+i,sc+i);
		st[i]+=st[i-1],sc[i]+=sc[i-1];
	}
	q[++qr]=mp(0,s*sc[n]);
	for(int i=1;i&lt;=n;i++){
		ll l=ql,r=qr;
		while(l&lt;r){
			ll mid=(l+r)&gt;&gt;1;
			if(inter(q[mid],q[mid+1])&gt;=st[i])r=mid;
			else l=mid+1;
		}
		dp[i]=q[l].fi*st[i]+q[l].se+st[i]*sc[i];
		pi curseg=mp(-sc[i],dp[i]+s*(sc[n]-sc[i]));
		while(ql&lt;qr &amp;&amp; inter(q[qr-1],q[qr])&gt;=inter(q[qr],curseg))qr--;
		q[++qr]=curseg;
	}
	printf("%lld",dp[n]);

	return 0;
}
</code></pre>

<h3 id="p3628-apio2010ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ"><a href="https://www.luogu.com.cn/problem/P3628">P3628 [APIO2010]ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ</a></h3>

<p>ç›´æ¥æ¨å¼å­ï¼Œæ–¹ç¨‹ä¸ºï¼š</p>

\[dp_i=(a s_i^2+b s_i+c) + \max_{j&lt;i}(\underbrace{-2a s_j}_{k_j}\times\underbrace{s_i}_{x_i} +\underbrace{dp_j+a s_j^2-b s_j}_{b_j})\]

<p>å…¶ä¸­æ–œç‡ä¸ x åæ ‡ $-2a s_i,s_i$ éƒ½å•è°ƒå˜åŒ–ï¼Œæ‰€ä»¥å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å³å¯ã€‚</p>

<p><strong>ä»£ç ï¼š</strong></p>

<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
#define fi first
#define se second
#define mp make_pair
using namespace std;
typedef long long ll;
typedef pair&lt;ll,ll&gt; pi;

const long double INF=1e18;
const long double EPS=1e-9;
const ll MXN=1e6+5;
ll n,a,b,c,ql=1,qr,dp[MXN];
pi q[MXN];

long double intersec(pi x,pi y){
	if(x.fi==y.fi)return y.se&gt;x.se?-INF:INF;
	return (long double)(y.se-x.se)/(x.fi-y.fi);
}
int main(){
	scanf("%lld%lld%lld%lld",&amp;n,&amp;a,&amp;b,&amp;c);
	q[++qr]=mp(0,0);
	for(ll i=1,tmp,s=0;i&lt;=n;i++){
		scanf("%lld",&amp;tmp);s+=tmp;
		while(ql&lt;qr &amp;&amp; intersec(q[ql],q[ql+1])+EPS&lt;s)ql++;
		dp[i]=s*q[ql].fi+q[ql].se+(a*s*s+b*s+c);
		pi cseg=mp(-2*a*s,dp[i]+a*s*s-b*s);
		while(ql&lt;qr &amp;&amp; intersec(q[qr-1],q[qr])&gt;intersec(q[qr-1],cseg)+EPS)qr--;
		q[++qr]=cseg;
	}
	printf("%lld",dp[n]);

	return 0;
}
</code></pre>

<h3 id="p3648-apio2014åºåˆ—åˆ†å‰²"><a href="https://www.luogu.com.cn/problem/P3648">P3648 [APIO2014]åºåˆ—åˆ†å‰²</a></h3>

<p>å‘ç°ç»“æœä¸åˆ‡å‰²é¡ºåºæ— å…³ï¼Œä¸éš¾æ¨å‡º dp å¼ï¼Œå…¶ä¸­æ–œç‡ä¸ x åæ ‡å•è°ƒå¢ã€‚</p>

<p>æ³¨æ„ç‰¹åˆ¤ä¸¤æ¡çº¿å¹³è¡Œçš„æƒ…å†µï¼Œè¿”å›æ­£è´Ÿæ— ç©·ï¼Œè‡³äºå…·ä½“è¿”å›å“ªä¸ªï¼Œå› é¢˜è€Œå¼‚ã€‚</p>

<p><strong>ä»£ç ï¼š</strong></p>

<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
#define fi first
#define se second
#define mp make_pair
using namespace std;
typedef long long ll;
typedef pair&lt;ll,ll&gt; pi;

const long double INF=1e18;
const ll MXN=1e5+5;
const ll MXK=205;

ll ql,qr;pi q[MXN];
long double inter(pi x,pi y){
	if(x.fi==y.fi)return y.se&gt;x.se?-INF:-INF;
	return (long double)(y.se-x.se)/(x.fi-y.fi);
}
ll n,k,arr[MXN];
ll dp[MXK][MXN];
int main(){

	scanf("%lld%lld",&amp;n,&amp;k);
	for(int i=1;i&lt;=n;i++){
		scanf("%lld",arr+i);
		arr[i]+=arr[i-1];
	}
	for(int i=1;i&lt;=k;i++){
		q[qr=ql=1]=mp(0,0);
		for(int j=1;j&lt;=n;j++){
			while(ql&lt;qr &amp;&amp; arr[j]&gt;=inter(q[ql],q[ql+1]))ql++;
			dp[i][j]=arr[j]*q[ql].fi+q[ql].se;
			pi cseg=mp(arr[j],dp[i-1][j]-arr[j]*arr[j]);
			while(ql&lt;qr &amp;&amp; inter(q[qr-1],q[qr])&gt;=inter(q[qr-1],cseg))qr--;
			q[++qr]=cseg;
		}
	}
	printf("%lld\n",dp[k][n]);
	for(int i=k,cur=n;i;i--){
		for(int j=1;j&lt;cur;j++)
			if(dp[i-1][j]+arr[j]*(arr[cur]-arr[j])==dp[i][cur]){
				cur=j;
				break;
			}
		printf("%lld\n",cur);
	}
	return 0;

}
</code></pre>

<h3 id="p5017-noip2018-æ™®åŠç»„-æ‘†æ¸¡è½¦"><a href="https://www.luogu.com.cn/problem/P5017">P5017 [NOIP2018 æ™®åŠç»„] æ‘†æ¸¡è½¦</a></h3>

<p>dp è½¬ç§»ä¸éš¾å˜æˆæ–œç‡ä¼˜åŒ–çš„å½¢å¼ï¼Œå¯ä»¥çº¿æ€§è§£å†³ã€‚</p>

<p>è¿˜å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ä¸¤äººåˆ°è¾¾æ—¶é—´ç›¸å·®è¶…è¿‡ $2m$ å¯ä»¥å½“æˆ $2m$ çš„æ€§è´¨ï¼Œç¼©çŸ­æ—¶é—´è½´ã€‚</p>

<p>å¤æ‚åº¦ $O(\min(nm,T))$</p>

<p><strong>ä»£ç ï¼š</strong></p>

<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
#define fi first
#define se second
#define mp make_pair
using namespace std;
typedef long long ll;
typedef pair&lt;ll,ll&gt; pi;
const ll MXN=505;
const ll MXT=1.1e5;
const ll INF=1e18;
ll n,m,ans=INF;
ll arr[MXN],s[MXT],si[MXT],dp[MXT];
ll ql=1,qr;
pi q[MXT];
inline long double inter(const pi &amp;a,const pi &amp;b){return a.fi==b.fi?(a.se&gt;b.se?-INF:INF):(long double)(a.se-b.se)/(b.fi-a.fi);}
int main(){
	scanf("%lld%lld",&amp;n,&amp;m);
	for(ll i=1;i&lt;=n;i++)scanf("%lld",arr+i);
	sort(arr+1,arr+1+n);
	for(ll i=n;i;i--)arr[i]=min(m&lt;&lt;1,arr[i]-arr[i-1]);
	for(ll i=1;i&lt;=n;i++){
		arr[i]+=arr[i-1];
		s[arr[i]]++;
		si[arr[i]]+=arr[i];
	}

	for(ll i=1;i&lt;=arr[n]+m;i++){
		s[i]+=s[i-1],si[i]+=si[i-1];
		if(i&gt;=m){
			pi cseg=mp(-s[i-m],dp[i-m]+si[i-m]);
			while(ql&lt;qr &amp;&amp; inter(q[qr-1],q[qr])&gt;=inter(q[qr],cseg))qr--;
			q[++qr]=cseg;
			while(ql&lt;qr &amp;&amp; i&gt;=inter(q[ql],q[ql+1]))ql++;
			dp[i]=q[ql].fi*i+q[ql].se;
		}
		dp[i]+=s[i]*i-si[i];
		if(i&gt;=arr[n])ans=min(ans,dp[i]);
	}
	printf("%lld",ans);
	return 0;
}
</code></pre>

<h3 id="p4027-noi2007-è´§å¸å…‘æ¢-æè¶…æ ‘"><a href="https://www.luogu.com.cn/problem/P4027">P4027 [NOI2007] è´§å¸å…‘æ¢</a> ï¼ˆæè¶…æ ‘ï¼‰</h3>

<p>å‘ç°æœ€ä¼˜æƒ…å†µä¸‹æ¯ä¸€æ¬¡ä¹°å…¥å¿…å®šæŠŠæ‰€æœ‰é’±éƒ½ç”¨äº†ï¼Œæ¯æ¬¡å–å‡ºéƒ½å¿…å®šæŠŠæ‰€æœ‰é‡‘åˆ¸å–äº†ã€‚</p>

<p>äºæ˜¯ä¸éš¾æ¨å‡ºè½¬ç§»æ–¹ç¨‹ä¸ºï¼ˆ$dp_i$ è¡¨ç¤ºç¬¬ i å¤©ï¼Œå–å¸ä¹‹åï¼Œä¹°å¸ä¹‹å‰ï¼Œæœ€å¤šæ‹¥æœ‰å¤šå°‘é’±ï¼‰ï¼š</p>

\[dp_i=max(dp_{i-1},\max(\underbrace{(B_i/A_i)}_{x_i}\times \underbrace{A_i dp_j/(A_j Rate_j+B_j)}_{k_j}+\underbrace{Rate_j A_i dp_j/(A_j Rate_j+B_j)}_{b_j}))\]

<p>å‘ç°æ–œç‡ä¸æ¨ªåæ ‡éƒ½ä¸ä¸€å®šå•è°ƒï¼Œåªèƒ½ç”¨æè¶…æ ‘ç»´æŠ¤ã€‚</p>

<p>åˆå› ä¸ºç”¨æè¶…æ ‘æŸ¥è¯¢çš„æ¨ªåæ ‡æ˜¯æµ®ç‚¹æ•°ï¼Œä¸å¤ªå¥½æï¼Œå¯ä»¥æå‰å°†ä¼šæŸ¥è¯¢åˆ°çš„ x åæ ‡ç¦»æ•£åŒ–ã€‚</p>

<p><strong>ä»£ç ï¼ˆç”šçŸ­ï¼‰ï¼š</strong></p>

<pre><code class="language-cpp">#include&lt;bits/stdc++.h&gt;
#define mp make_pair
#define fi first
#define se second
using namespace std;
typedef long long ll;
typedef pair&lt;double,double&gt; pr;
const ll MXN=1e5+5;
const ll INF=1e18;
ll n;
double arr[MXN],brr[MXN],rate[MXN],dp[MXN],pool[MXN];


struct node{ll ls,rs;pr line;}t[MXN&lt;&lt;2];ll rt,nodec;
inline double f(pr line,ll x){return line.fi*pool[x]+line.se;}
inline double f(pr line,double x){return line.fi*x+line.se;}
inline ll nnode(){return t[++nodec].line=mp(0,-INF),nodec;}
inline void mod(ll &amp;p,ll l,ll r,pr ml){
	ll mid=(l+r)&gt;&gt;1;
	if(!p)p=nnode();
	if(f(ml,mid)&gt;f(t[p].line,mid))swap(ml,t[p].line);
	if(l==r)return;
	ml.fi&lt;t[p].line.fi?mod(t[p].ls,l,mid,ml):mod(t[p].rs,mid+1,r,ml);
}
inline double que(ll p,ll l,ll r,double qx){
	if(!p || l==r)return f(t[p].line,qx);
	ll mid=(l+r)&gt;&gt;1;
	return max(f(t[p].line,qx),qx&gt;pool[mid]?que(t[p].rs,mid+1,r,qx):que(t[p].ls,l,mid,qx));
}
int main(){
	scanf("%lld%lf",&amp;n,&amp;dp[0]);
	for(int i=1;i&lt;=n;i++){
		scanf("%lf%lf%lf",arr+i,brr+i,rate+i);
		pool[i]=brr[i]/arr[i];
	}
	sort(pool+1,pool+1+n);
	for(int i=1;i&lt;=n;i++){
		dp[i]=max(dp[i-1],arr[i]*que(rt,1,n,brr[i]/arr[i]));
		double k=dp[i]/(arr[i]*rate[i]+brr[i]);
		mod(rt,1,n,mp(k,k*rate[i]));
	}
	printf("%.3f",dp[n]);
	
	return 0;
}
</code></pre>
:ET